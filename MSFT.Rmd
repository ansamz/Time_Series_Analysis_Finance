---
title: "The Impact of News Sentiment on MSFT"
author: "Ansam Zedan, Daniel Wullschleger"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
if (!require("vars")) install.packages("vars", dependencies=TRUE)
if (!require("tseries")) install.packages("tseries", dependencies=TRUE)
if (!require("quantmod")) install.packages("quantmod", dependencies=TRUE)
if (!require("PerformanceAnalytics")) install.packages("PerformanceAnalytics", dependencies=TRUE)
if (!require("forecast")) install.packages("forecast", dependencies=TRUE)
if (!require("rugarch")) install.packages("rugarch", dependencies=TRUE)
if (!require("tinytex")) install.packages("tinytex", dependencies=TRUE)
if (!require("zoo")) install.packages("zoo", dependencies=TRUE)
if (!require("ggplot2")) install.packages("ggplot2", dependencies=TRUE)

library(PerformanceAnalytics)
library(forecast)
library(rugarch)
library(vars)
library(tseries)
library(quantmod)
library(tinytex)
library(zoo)
library(ggplot2)
```
# Introduction 
In recent years Microsoft has pushed and achieved great progress in a diverse portfolio of technologies (Microsoft, 2022) including also partnerships with AI research centers such as OpenAI. Alongside this development, its stock price has since reached new all-time highs and persists to be a major player in tech investments.

Inspired by this evolution, this paper provides an analysis and forecast of the stock price of Microsoft based on news sentiment data from subreddits such as r/worldnews, r/investing and r/stocks using a vector autoregressive (VAR) model.

Vector Autoregressive (VAR) processes are popular in economics for their flexibility and simplicity as models for multivariate time series data, forming a vector between variables that affect each other (Suharsono et al. 2017; Aptech 2021). The relationship between the stock prices and the news events will be analysed using a Granger causality testing, similarly as Bhowmik et al. (2022) proceeded when comparing multiple markets.

Hereby MSFT price data was downloaded through the Yahoo API in R and Reddit posts were scraped using Jupyter Notebooks. The python libraries nltk, textblob and wordlcoud were of support in the creation of the sentiment scores.

# Analysis:
First, we import the data and convert it to a time series so that we may plot it

```{r echo=FALSE, include=TRUE}
MSFT <- read.csv("data/final_data.csv")
MSFT$Index <- as.Date(MSFT$Index)
MSFT$MSFT.Adjusted <- as.numeric(as.character(MSFT$MSFT.Adjusted))
MSFT$average_polarity <- as.numeric(as.character(MSFT$average_polarity))
MSFT_ts <- zoo(MSFT$MSFT.Adjusted, order.by = MSFT$Index)

plot(MSFT_ts)
```
We see a clear trend, which is an indicator for non-stationarity, so we do an Augmented Dickey-Fuller (ADF) Test to see whether the data is in fact non-stationary.
 
```{r echo=FALSE, include=TRUE}
adf.test(MSFT_ts) 
```

We see that based on the p-value of 0.7051 the ADF Test suggests that the price data is non-stationary. So we a apply a log-transform with subsequent differencing to calculate continuous returns on MSFT. These should behave stationary.

In the same step, we divide the dataset into a Train/Test Split, whereas November 2023 will serve as a test set for later predicitions

```{r echo=FALSE, include=TRUE}
MSFT_returns <- na.omit(diff(log(MSFT_ts)))
MSFT_returns

MSFT_returns_train <- window(MSFT_returns, sart ="2022-01-04", end="2023-09-30")
MSFT_returns_test <- window(MSFT_returns, start="2023-10-01")

plot(MSFT_returns)
adf.test(MSFT_returns)
```
Now, that we deal with stationary data we can begin with our analysis. 

First we create a time series of news sentiment data. Combined with the price returns, we can create a Vector Autoregression model. This will be our basis to check whether News are a causal driver for MSFT price returns.

We then do a coefficient test, to get more information on the statistical significance of the coefficients of our VAR Model.

```{r echo=FALSE, include=TRUE}
news_ts <- zoo(MSFT$average_polarity, order.by = MSFT$Index)
news_train <- window(news_ts, start ="2022-01-04", end="2023-09-30")
news_test <- window(news_ts, start="2023-10-01")
MSFT_VAR_Data <- cbind(MSFT_returns_train, news_train)
colnames(MSFT_VAR_Data) <- c("MSFT_Returns", "News_Sentiment")

MSFT_VAR <- VAR(MSFT_VAR_Data, ic="AIC", lag.max = 24)
coeftest(MSFT_VAR)
```

We see that almost none of the coefficients have a statistical significance. As a next step, we do a Granger causality test to confirm that news data is in fact non a causal driver for the MSFT stock price 

```{r echo=FALSE, include=TRUE}
causality(MSFT_VAR, cause="News_Sentiment")["Granger"] 
```
The p-value of 0.34 suggests that the gathered News sentiments are not a causal driver for the MSFT stock price. This leads us to reject our hypothesis.

However, from a practical point of view, our VAR model may still be of some use when applied for forecasting purposes. To see if the inclusion of the news sentiment in our model has an improving effect on the models accuracy when predicting the price movements of MSFT we do some forecasting for our testing period where we include the news sentiment data of the testing period.

At the same time, we setup an ARMA model that is purely based on MSFTs previous price movements. It will serve as our benchmark. 


```{r echo=FALSE, include=TRUE}
forecast_data <- data.frame(
  MSFT_Returns = rep(NA, length(news_test)),
  News_Sentiment = news_test
)

forecast <- predict(MSFT_VAR, newdata = forecast_data, n.ahead=43)
plot(forecast)
MSFT_VAR_pred <- forecast$fcst$MSFT_Returns

rmse_VAR <- sqrt(mean((MSFT_returns_test - MSFT_VAR_pred)^2))
rmse_VAR

MSFT_ARMA <- auto.arima(MSFT_returns_train)
MSFT_ARMA_pred <- forecast(MSFT_ARMA, level=95, h = length(news_test))
plot(MSFT_ARMA_pred)

rmse_ARMA <- sqrt(mean((MSFT_returns_test - MSFT_ARMA_pred$mean)^2))
rmse_ARMA

```
We see that auto.arima has found that the auto-regressive (AR) part of our benchmark ARMA model has an order of 2, since the coefficients ar1 and ar2 were estimated. The Absence of ma coefficients suggests that the Moving Average (MA) part has an order of 0. Therefore, we essentially deal with an AR(2) model as our benchmark. During forecasting, we also see that it uses a mean of 0 with a confidence band for all future values. This makes sense, as we deal with stationary data that commonly has a mean of 0. 

While the VAR model reaches an RSME of 0.036 when compared to the truth values of our test set, the AR(2) benchmark reaches an RSME of 0.014. This means, our more sophisticated VAR model actually performs worse than the more simple AR(2) that is purely based on past values.


```{r echo=FALSE, include=TRUE}

```

Bibliography:

Agus Shuarsono, Auliya Aziza and Wara Pramesti (2017); Comparison of vector autoregressive (VAR) and vector error correction models (VECM) for index of ASEAN stock price. DOI 10.1063/1.5016666

Aptech, Introduction to the Fundamentals of Vector Autoregressive Models (2021). https://www.aptech.com/blog/introduction-to-the-fundamentals-of-vector-autoregressive-models/

Microsoft, 2022 a look back at a year of accelerating progress in AI.
https://www.microsoft.com/en-us/research/blog/2022-a-look-back-at-a-year-of-accelerating-progress-in-ai/

Roni Bhowmik, Gouranga Chandra Debnath, Nitai Chandra Debnath, Shouyang Wang (2022); Emerging stock market reactions to shocks during various crisis periods 2022). DOI 10.1371/journal.pone.0272450
